<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis OS</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/static/ui.css">
</head>
<body class="selection:bg-blue-500 selection:text-white">

    <div class="aurora-bg"></div>
    <div class="noise-overlay"></div>

    <div id="app" class="relative z-10 w-full h-full flex flex-col md:flex-row p-6 gap-6">
        
        <div class="w-full md:w-[420px] ps5-card rounded-3xl flex flex-col overflow-hidden shrink-0 h-full md:h-auto">
            
            <div class="p-6 border-b border-white/5 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center backdrop-blur-md">
                        <i class="fas fa-ghost text-lg"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg tracking-wide">AI Ëâ∫ÊúØÂàõ‰ΩúÂô®</h1>
                        <p class="text-[10px] text-white/50 uppercase tracking-[0.2em]">v0.1 Stable Version</p>
                    </div>
                </div>
                <div class="w-2 h-2 rounded-full" :class="loading ? 'bg-blue-500 animate-pulse' : 'bg-emerald-500'"></div>
            </div>

            <div class="flex-1 scroll-area--hidden p-6 space-y-8">
                
                <div v-if="!hasSavedKey" class="space-y-2">
                    <label class="text-xs font-bold text-white/60 uppercase tracking-widest pl-1">Access Token</label>
                    <input v-model="apiKey" type="password" class="ps5-input w-full px-4 py-3 rounded-xl text-sm" placeholder="Enter Credentials...">
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-bold text-white/60 uppercase tracking-widest pl-1">È£éÊ†ºÁü©Èòµ</label>
                    <select v-model="form.style" class="ps5-input ps5-select w-full px-4 py-3 rounded-xl text-sm cursor-pointer">
                        <option value="none">üí† Ê†áÂáÜÊ∏≤Êüì</option>
                        <optgroup label="SÁ∫ßÂ§ßÂ∏à">
                            <option v-for="(v, k) in db.styles_master" :value="k">{{ k }}</option>
                        </optgroup>
                        <optgroup label="Áü•ÂêçÂä®ÁîªÂÖ¨Âè∏">
                            <option v-for="(v, k) in db.styles_studio" :value="k">{{ k }}</option>
                        </optgroup>
                        <optgroup label="Áã¨ÁâπÈ£éÊ†º">
                            <option v-for="(v, k) in db.styles_unique" :value="k">{{ k }}</option>
                        </optgroup>
                    </select>

                    <div class="flex gap-2">
                        <button @click="form.aspectRatio = '3:4'" class="flex-1 py-3 rounded-xl border border-white/10 hover:bg-white/10 transition text-xs font-bold flex items-center justify-center gap-2" :class="form.aspectRatio === '3:4' ? 'bg-white text-black hover:bg-white' : 'text-white/60'">
                            <i class="fas fa-portrait"></i> 3:4
                        </button>
                        <button @click="form.aspectRatio = '16:9'" class="flex-1 py-3 rounded-xl border border-white/10 hover:bg-white/10 transition text-xs font-bold flex items-center justify-center gap-2" :class="form.aspectRatio === '16:9' ? 'bg-white text-black hover:bg-white' : 'text-white/60'">
                            <i class="fas fa-tv"></i> 16:9
                        </button>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-bold text-white/60 uppercase tracking-widest pl-1">‰∫∫Áâ©Ê°£Ê°à</label>
                    <div class="grid grid-cols-2 gap-3">
                        <select v-model="form.clothing" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs">
                            <option value="">üëî ÊúçË£Ö</option>
                            <option v-for="(v, k) in db.CLOTHING" :value="k">{{ v.label }}</option>
                        </select>
                        <select v-model="form.accessory" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs">
                            <option value="">üëì ÈÖçÈ•∞</option>
                            <option v-for="(v, k) in db.accessories" :value="k">{{ k }}</option>
                        </select>
                        
                        <select v-model="form.body" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs">
                            <option value="">üíÉ ‰ΩìÂûã</option>
                            <option v-for="(v, k) in db.SHAPES" :value="k">{{ v.label }}</option>
                        </select>
                        <select v-model="form.cup" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs">
                            <option value="">üëô Ê¨ßÊ¥æ</option>
                            <option v-for="(v, k) in db.CUPS" :value="k">{{ v.label }}</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-bold text-white/60 uppercase tracking-widest pl-1">ÂØºÊºîËÆæÁΩÆ</label>
                    <div class="space-y-3">
                        <select v-model="form.action" class="ps5-input ps5-select w-full px-4 py-3 rounded-xl text-xs"><option value="">‚öîÔ∏è Âä®‰ΩúÂßøÂäø</option><option v-for="(v, k) in db.actions" :value="k">{{ k }}</option></select>
                        <select v-model="form.scene" class="ps5-input ps5-select w-full px-4 py-3 rounded-xl text-xs"><option value="">üèôÔ∏è ÁéØÂ¢É</option><option v-for="(v, k) in db.scenes" :value="k">{{ k }}</option></select>
                        <div class="grid grid-cols-2 gap-3">
                            <select v-model="form.shot" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs"><option value="">üì∑ ÊôØÂà´</option><option v-for="(v, k) in db.shots" :value="k">{{ k }}</option></select>
                            <select v-model="form.effect" class="ps5-input ps5-select w-full px-3 py-3 rounded-xl text-xs"><option value="">‚ú® ÁâπÊïà</option><option v-for="(v, k) in db.effects" :value="k">{{ k }}</option></select>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-bold text-white/60 uppercase tracking-widest pl-1">ÊâãÂä®ÊèèËø∞</label>
                    <textarea v-model="form.customText" class="ps5-input w-full p-4 rounded-xl text-xs resize-none h-24" placeholder="Ê∑ªÂä†ËØ¶ÁªÜ‰ø°ÊÅØ..."></textarea>
                    
                    <div @click="$refs.fileInput.click()" class="relative h-12 rounded-xl border border-dashed border-white/20 hover:border-white/50 hover:bg-white/5 transition cursor-pointer flex items-center justify-center overflow-hidden group">
                        <input type="file" ref="fileInput" @change="handleFileUpload" class="hidden" accept="image/*">
                        
                        <div v-if="!previewImage" class="flex items-center gap-2 text-white/50 group-hover:text-white transition">
                            <i class="fas fa-upload"></i> <span class="text-xs uppercase font-bold tracking-wider">‰∏ä‰º†ÂèÇËÄÉÂõæ</span>
                        </div>
                        
                        <div v-else class="w-full h-full relative">
                            <img :src="previewImage" class="w-full h-full object-cover opacity-50">
                            <div class="absolute inset-0 flex items-center justify-center gap-2 bg-black/40 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition">
                                <span class="text-xs font-bold">Change</span>
                                <button @click.stop="clearFile" class="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center hover:scale-110 transition">
                                    <i class="fas fa-times text-[10px]"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="errorMsg" class="p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-200 text-xs leading-relaxed">
                    <i class="fas fa-circle-exclamation mr-2"></i> {{ errorMsg.split("\n")[0] }}
                </div>
                
                <div class="h-20"></div> </div>

            <div class="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-[#000000] to-transparent pointer-events-none">
                <button @click="generate" :disabled="loading" class="pointer-events-auto w-full py-4 rounded-2xl bg-white text-black font-black uppercase tracking-widest text-sm hover:scale-[1.02] active:scale-[0.98] transition shadow-[0_0_40px_rgba(255,255,255,0.2)] flex items-center justify-center gap-3 group">
                    <span v-if="!loading">ÂºÄÂßãÂàõ‰Ωú</span>
                    <i v-if="!loading" class="fas fa-arrow-right group-hover:translate-x-1 transition"></i>
                    <div v-else class="ps5-loader border-slate-900 border-t-transparent"></div>
                </button>
            </div>
        </div>

        <div class="flex-1 flex flex-col h-full min-w-0">
            
            <div class="h-16 flex items-center justify-end px-4 gap-6">
                <div class="text-right">
                    <div class="text-xs font-bold text-white/80">{{ new Date().toLocaleTimeString() }}</div>
                    <div class="text-[10px] text-white/40 uppercase tracking-wider">Online</div>
                </div>
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 p-[2px]">
                    <div class="w-full h-full rounded-full bg-black flex items-center justify-center">
                        <i class="fas fa-user text-xs text-white"></i>
                    </div>
                </div>
            </div>

            <div class="absolute top-6 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center">
                
                <div class="dynamic-island-container group transition-all duration-500 ease-[cubic-bezier(0.19,1,0.22,1)]"
                     :class="notifyState.show ? '!w-[280px] !h-[48px] !rounded-full !bg-black/90 !border-emerald-500/50 !shadow-[0_0_30px_rgba(16,185,129,0.3)]' : ''">
                    
                    <div class="island-idle-content" :class="{ 'opacity-0 pointer-events-none': notifyState.show }">
                        <div class="siri-glow absolute"></div>
                        <div class="relative z-10 flex items-center gap-2 text-[10px] font-bold tracking-widest uppercase text-white/80">
                            <i class="fas fa-microchip text-violet-400"></i>
                            <span>Core Idle</span>
                        </div>
                    </div>

                    <div class="shell-content" :class="{ '!opacity-0 !pointer-events-none': notifyState.show }">
                        <div class="flex items-center justify-between mb-4 border-b border-white/10 pb-3">
                            <div class="flex items-center gap-2">
                                <div class="w-2.5 h-2.5 rounded-full bg-[#ff5f56]"></div>
                                <div class="w-2.5 h-2.5 rounded-full bg-[#ffbd2e]"></div>
                                <div class="w-2.5 h-2.5 rounded-full bg-[#27c93f]"></div>
                                <span class="text-[10px] text-white/40 font-mono ml-3">prompt_matrix.sh</span>
                            </div>
                            <button @click.stop="copyPrompt(finalPrompt)" class="text-[10px] bg-white/5 hover:bg-white/20 border border-white/10 text-white px-3 py-1 rounded transition flex items-center gap-2 group/btn">
                                <i class="fas fa-copy text-white/50 group-hover/btn:text-white"></i> Copy
                            </button>
                        </div>
                        <div class="flex-1 scroll-area--hidden text-xs font-mono text-cyan-300/90 leading-relaxed break-words select-text p-1">
                            <div class="mb-2 text-slate-500">Last login: {{ new Date().toLocaleTimeString() }} on ttys001</div>
                            <span class="text-pink-500 font-bold">root@genesis:~$</span> ./generate --prompt <br>
                            <span class="text-white/90 pl-4 block mt-1 border-l-2 border-white/10">"{{ finalPrompt }}"</span>
                            <span class="inline-block w-2 h-4 bg-white/50 ml-1 animate-pulse align-middle mt-2"></span>
                        </div>
                        <div class="mt-3 pt-2 border-t border-white/5 flex justify-between text-[9px] text-white/30 font-mono tracking-wider">
                            <span>MEM: {{ Math.floor(finalPrompt.length / 1024 * 100) / 100 }} KB</span>
                            <span class="text-emerald-500">‚óè SYSTEM READY</span>
                        </div>
                    </div>

                    <div class="absolute inset-0 flex items-center justify-center gap-3 transition-all duration-300"
                         :class="notifyState.show ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'">
                        
                        <div class="w-5 h-5 rounded-full bg-emerald-500 flex items-center justify-center shadow-lg shadow-emerald-500/50">
                            <i class="fas fa-check text-[10px] text-black"></i>
                        </div>
                        
                        <div class="text-xs font-bold text-white tracking-wider font-mono">
                            {{ notifyState.message }}
                        </div>
                    </div>

                </div>
            </div>
            <div class="flex-1 relative flex items-center justify-center p-8 overflow-hidden">
                
                <div class="absolute inset-0 flex items-center justify-center z-0 pointer-events-none">
                    <div class="text-center transition-all duration-700 ease-in-out transform" 
                         :class="currentViewImage ? 'opacity-0 scale-90' : 'opacity-20 scale-100'">
                        <i class="fas fa-gamepad text-6xl mb-4"></i>
                        <div class="text-sm font-bold uppercase tracking-[0.3em]">Press Start</div>
                    </div>
                </div>

                <transition name="fade">
                    <div v-if="currentViewImage" class="relative group max-w-full max-h-full z-10">
                        <div class="absolute -inset-4 bg-white/20 blur-3xl rounded-full opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                        
                        <img :src="currentViewImage.url" class="relative z-10 rounded-lg shadow-2xl max-h-[70vh] object-contain border border-white/10">

                        <div class="absolute -bottom-16 left-1/2 -translate-x-1/2 flex items-center gap-4 opacity-0 group-hover:opacity-100 group-hover:bottom-6 transition-all duration-500 z-20">
                            <button @click="downloadImage(currentViewImage)" class="h-12 px-6 rounded-full bg-white/10 hover:bg-white text-white hover:text-black backdrop-blur-md border border-white/20 font-bold text-xs uppercase tracking-wider flex items-center gap-2 transition">
                                <i class="fas fa-download"></i> Save
                            </button>
                            <button @click="currentViewImage = null" class="w-12 h-12 rounded-full bg-black/50 hover:bg-red-500/80 backdrop-blur-md border border-white/10 text-white flex items-center justify-center transition">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </transition>
            </div>

            <div class="h-40 w-full relative z-10">
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                
                <div ref="timelineRef"
                     @mousedown="startDrag" 
                     @mouseleave="stopDrag" 
                     @mouseup="stopDrag" 
                     @mousemove="doDrag"
                     class="relative h-full flex items-center px-8 gap-6 scroll-area--hidden pb-4 cursor-grab active:cursor-grabbing select-none">
                    
                    <div class="flex-shrink-0 flex items-center gap-3 text-white/40 font-bold uppercase tracking-widest text-xs rotate-180" style="writing-mode: vertical-rl;">
                        <span>story</span>
                        <div class="w-[1px] h-8 bg-white/20"></div>
                    </div>

                    <transition-group name="slide-up">
                        <div v-for="(item, index) in history" :key="item.filename || index" 
                             @click="currentViewImage = item"
                             class="flex-shrink-0 w-48 aspect-video rounded-xl bg-white/5 border border-white/10 overflow-hidden relative group cursor-pointer hover:w-56 hover:border-white transition-all duration-300 shadow-lg">
                            
                            <img :src="item.url" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition duration-500 pointer-events-none">
                            
                            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition duration-300 flex flex-col justify-end p-4">
                                <div class="text-[10px] font-bold text-white truncate">{{ item.style || 'Standard' }}</div>
                                <div class="flex gap-2 mt-2">
                                    <button @click.stop="restoreSettings(item)" class="p-2 rounded bg-white/20 hover:bg-white text-white hover:text-black transition text-xs" title="Restore"><i class="fas fa-undo"></i></button>
                                    <button @click.stop="copyPrompt(item.prompt)" class="p-2 rounded bg-white/20 hover:bg-white text-white hover:text-black transition text-xs" title="Copy"><i class="fas fa-copy"></i></button>
                                </div>
                            </div>
                        </div>
                    </transition-group>
                    
                    <div v-if="history.length === 0" class="text-white/20 text-xs font-bold uppercase tracking-widest pl-4">
                        No Recent Activity
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { createApp } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
        import { AppConfig } from './static/js/app.js';
        createApp(AppConfig).mount('#app');
    </script>
</body>
</html>